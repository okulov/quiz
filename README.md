# quiz

##Установка и настройка



Модуль протестирован:

- Python (3.9)
- Django (2.2)
- Django REST Framework 3.12.4

###Установка используемых модулей

Наберите в командной строке, находясь в корне проекта (перейдите в виртуальное окружение при его использовании): 

```bash
pip install -r requirements.txt
```

###Настройка базы данных

Текущий сервер использует sqlite, чтобы изменить базу данных, укажите соответствующие настройки в файле settings.py основного модуля quiz   
Чтобы инициализировать базу данных, запустите команду: 

```bash
python manage.py migrate --run-syncdb
```

###Создание суперпользователя

У сервера есть административная часть, доступная по адресу ../admin. Чтобы зайти в нее, создайте суперпользователя командой:  

```bash
python manage.py createsuperuser
```

Введите имя пользователя и нажмите Enter.
```bash
Username: admin
```
Теперь введите email:
```bash
Email address: admin@example.com
```
И наконец введите пароль.
```bash
Password: **********
Password (again): *********
Superuser created successfully.
```

###Запуск сервера

Чтобы запустить сервер, перейдите в каталог **quiz** и запустите команду: 

```bash
python manage.py runserver
```

##API

###Авторизация
Используется авторизация черезе сессии или токены. Используется модуль  
Создание пользователя **user** с паролем **123**: 
```bash
curl -X POST http://127.0.0.1:8000/auth/users/ --data 'username=user&password=123'
```
Чтобы через API получить токен для этого пользователя:
```bash
curl -X POST http://127.0.0.1:8000/auth/token/login/ --data 'username=user&password=123'
{"auth_token": "b704c9fc3655635646356ac2950269f352ea1139"}
```

Получение данных (опросы) с использованием авторизации с помощью полученного токена: 
```bash
curl -LX GET http://127.0.0.1:8000/api/polls -H 'Authorization: Token b704c9fc3655635646356ac2950269f352ea1139'
```

Более подробно про возможности аутентификации можно прочитать на странице модуля djoser: https://djoser.readthedocs.io/en/latest/

###Просмотр по HTTP
API интерфейс доступен по адресу **http://127.0.0.1:8000/api/**.

###Название элементов (для вставки в адрес запроса):

<li> polls - опросы для пользователей (только активные по дате старта)
<li> admin - опросы для администрирования
<li> questions - вопросы для опросов   
<li> answers - варианты ответов для вопросов
<li> results - результаты прохождения
<li> userpolls - опросы по определенному пользователю (всегда с указанием ID пользоателя)

###Методы: 
<li> GET - получение списка элементов
<li> POST - создание новых элементов
<li> PUT - исправление текущих (с передачей всех полей в форме)
<li> PATCH - исправление текущих (с передачей новых значений в форме)
<li> DELETE - удаление элементов

Получение полного списка элементов: 
```bash
http://127.0.0.1:8000/api/{название списка}/
```

Получение одного элемента для просмотра/редактирования/удаления: 
```bash
http://127.0.0.1:8000/api/{название списка}/{id}
```

###Администрирование опросов

Для заведения опроса нужно с помощью метода POST отправить по адресу   http://127.0.0.1:8000/api/admin/ данные по опросу: 
<li> "name" - Название
<li> "description" - описание
<li> "date_start" - дата старта
<li> "date_end" - дата окончания
<li> "questions" - список вопросов (id)

Если вопросов на момент создания опроса нет, то можно не отправлять, тогда будет заведен опрос без вопросов :) Вопросы можно будет добавить в дальнейшем с помощью метода PATCH отправленного по адресу: 
 http://127.0.0.1:8000/api/admin/{id}, где id - идентификатор созданного ранее опроса. 

Аналогично с другими сущностями - в теле запроса на создвание вопроса должны быть указаны ID вариантов ответов (answers).

###Прохождение и просмотр пройденных опросов

Получение списка активных опросов: 
```bash
http://127.0.0.1:8000/api/polls/
```

Результаты прохождения опросов сохраняются в таблице Result путем отправки POST запроса на соответсвующий указанный выше адрес (results).

Поля результата: 
<li>'create_on' - дата создания опроса
<li>'user' - id пользователя (при сохранении, если id не найдем в базе, он создается)
<li>'poll' - id опроса
<li>'res_answers' - список id результатов ответа на определенный вопрос 

Поля результата ответа на вопрос res_answers:
<li>'text' - ответ пользователя. Должен принимать текстовую строку. Для вопроса с типом ONE или MANY содержит id вариантов ответа, выбранных пользователем.  
<li>'question' - id вопроса. 

Получение результатов по id пользователя: 
```bash
http://127.0.0.1:8000/api/{userpolls}/{id}
```